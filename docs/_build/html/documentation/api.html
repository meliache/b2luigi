

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>API Documentation &mdash; b2luigi 0.4.4 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="b2luigi.basf2_helper package" href="b2luigi.basf2_helper.html" />
    <link rel="prev" title="Belle II specific examples" href="../advanced/basf2-examples.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> b2luigi
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/quickstart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/batch.html">Batch Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/basf2-examples.html">Belle II specific examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">API Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#top-level-function">Top-Level Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="#super-hero-task-classes">Super-hero Task Classes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#settings">Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-functions">Other functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="b2luigi.basf2_helper.html">b2luigi.basf2_helper package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="run_modes.html">Run Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../advanced/development.html">Development and TODOs</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">b2luigi</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>API Documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/documentation/api.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="api-documentation">
<span id="api-documentation-label"></span><h1>API Documentation<a class="headerlink" href="#api-documentation" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> summarizes different topics to help you in your everyday task
creation and processing.
Most important is the <a class="reference internal" href="#b2luigi.process" title="b2luigi.process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">b2luigi.process()</span></code></a> function, which lets you run
arbitrary task graphs on the batch.
It is very similar to <code class="docutils literal notranslate"><span class="pre">luigi.build</span></code>, but lets you hand in additional parameters
for steering the batch execution.</p>
<div class="section" id="top-level-function">
<h2>Top-Level Function<a class="headerlink" href="#top-level-function" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="b2luigi.process">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">task_like_elements</span></em>, <em class="sig-param"><span class="n">show_output</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">dry_run</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">test</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="n">batch</span><span class="o">=</span><span class="default_value">False</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this function in your main method to tell <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> where your entry
point of the task graph is.
It is very similar to <code class="docutils literal notranslate"><span class="pre">luigi.build</span></code> with some additional configuration options.</p>
<p class="rubric">Example</p>
<p>This example defines a simple task and tells <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> to execute it 100 times
with different parametes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">b2luigi</span>
<span class="kn">import</span> <span class="nn">random</span>


<span class="k">class</span> <span class="nc">MyNumberTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">some_parameter</span> <span class="o">=</span> <span class="n">b2luigi</span><span class="o">.</span><span class="n">Parameter</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b2luigi</span><span class="o">.</span><span class="n">LocalTarget</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;results/output_file_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">some_parameter</span><span class="si">}</span><span class="s2">.txt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">random_number</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">()</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random_number</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">b2luigi</span><span class="o">.</span><span class="n">process</span><span class="p">([</span><span class="n">MyNumberTask</span><span class="p">(</span><span class="n">some_parameter</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
</pre></div>
</div>
<p>All flag arguments can also be given as command line arguments.
This means the call with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b2luigi</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">batch</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to calling the script with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">script</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">batch</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>task_like_elements</strong> (<a class="reference internal" href="#b2luigi.Task" title="b2luigi.Task"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Task</span></code></a> or list) – Task(s) to execute with luigi.
Can either be a list of tasks or a task instance.</p></li>
<li><p><strong>show_output</strong> (<em>bool</em><em>, </em><em>optional</em>) – Instead of running the task(s), write out all output files
which will be generated marked in color, if they are present already.
Good for testing of your tasks will do, what you think they should.</p></li>
<li><p><strong>dry_run</strong> (<em>bool</em><em>, </em><em>optional</em>) – Instead od running the task(s), write out which tasks will
be executed. This is a simplified form of dependency resolution, so this
information may be wrong in some corner cases. Also good for testing.</p></li>
<li><p><strong>test</strong> (<em>bool</em><em>, </em><em>optional</em>) – Does neither run on the batch system, with multiprocessing
or dispatched (see <a class="reference internal" href="#b2luigi.DispatchableTask" title="b2luigi.DispatchableTask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">DispatchableTask</span></code></a>) but directly on the machine for
debugging reasons. Does output all logs to the console.</p></li>
<li><p><strong>batch</strong> (<em>bool</em><em>, </em><em>optional</em>) – Execute the tasks on the selected batch system.
Refer to <a class="reference internal" href="../usage/quickstart.html#quick-start-label"><span class="std std-ref">Quick Start</span></a> for more information.
The default batch system is LSF, but this can be changed with the <cite>batch_system</cite>
settings. See <a class="reference internal" href="#b2luigi.get_setting" title="b2luigi.get_setting"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_setting</span></code></a> on how to define settings.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments passed to <code class="docutils literal notranslate"><span class="pre">luigi.build</span></code>.</p></li>
</ul>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You should always have just a single call to <code class="docutils literal notranslate"><span class="pre">process</span></code> in your script.
If you need to have multiple calls, either use a <a class="reference internal" href="#b2luigi.WrapperTask" title="b2luigi.WrapperTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">b2luigi.WrapperTask</span></code></a>
or two scripts.</p>
</div>
</dd></dl>

</div>
<div class="section" id="super-hero-task-classes">
<h2>Super-hero Task Classes<a class="headerlink" href="#super-hero-task-classes" title="Permalink to this headline">¶</a></h2>
<p>If you want to use the default <code class="docutils literal notranslate"><span class="pre">luigi.Task</span></code> class or any derivative of it,
you are totally fine.
No need to change any of your scripts!
But if you want to take advantage of some of the recipies we have developed
to work with large luigi task sets, you can use the drop in replacements
from the <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> package.
All task classes (except the <a class="reference internal" href="#b2luigi.DispatchableTask" title="b2luigi.DispatchableTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">b2luigi.DispatchableTask</span></code></a>, see below) are superclasses of
a <code class="docutils literal notranslate"><span class="pre">luigi</span></code> class.
As we import <code class="docutils literal notranslate"><span class="pre">luigi</span></code> into <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code>, you just need to replace</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">luigi</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">b2luigi</span> <span class="k">as</span> <span class="nn">luigi</span>
</pre></div>
</div>
<p>and you will have all the functionality of <code class="docutils literal notranslate"><span class="pre">luigi</span></code> and <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code>
without the need to change anything!</p>
<dl class="py class">
<dt id="b2luigi.Task">
<em class="property">class </em><code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">Task</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.Task" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">luigi.task.Task</span></code></p>
<p>Drop in replacement for <code class="docutils literal notranslate"><span class="pre">luigi.Task</span></code> which is 100% API compatible.
It just adds some useful methods for handling output file name generation using
the parameters of the task.
See <a class="reference internal" href="../usage/quickstart.html#quick-start-label"><span class="std std-ref">Quick Start</span></a> on information on how to use the methods.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyAverageTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">MyNumberTask</span><span class="p">,</span> <span class="n">some_parameter</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_output</span><span class="p">(</span><span class="s2">&quot;average.txt&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Build the mean</span>
        <span class="n">summed_numbers</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">input_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_input_file_names</span><span class="p">(</span><span class="s2">&quot;output_file.txt&quot;</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">summed_numbers</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">average</span> <span class="o">=</span> <span class="n">summed_numbers</span> <span class="o">/</span> <span class="n">counter</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_output_file</span><span class="p">(</span><span class="s2">&quot;average.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">average</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="py method">
<dt id="b2luigi.Task.add_to_output">
<code class="sig-name descname">add_to_output</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">output_file_name</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.Task.add_to_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Call this in your output() function to add a target to the list of files,
this task will output.
Always use in combination with <cite>yield</cite>.
This function will automatically add all current parameter values to
the file name when used in the form</p>
<blockquote>
<div><p>result_dir/param_1=value/param_2=value/output_file_name</p>
</div></blockquote>
<p>This function will automatically use a <code class="docutils literal notranslate"><span class="pre">LocalTarget</span></code>.
If you do not want this, you can override the <code class="xref py py-obj docutils literal notranslate"><span class="pre">_get_output_file_target</span></code> function.</p>
<p class="rubric">Example</p>
<p>This adds two files called <code class="docutils literal notranslate"><span class="pre">some_file.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">some_other_file.txt</span></code> to the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_output</span><span class="p">(</span><span class="s2">&quot;some_file.txt&quot;</span><span class="p">)</span>
    <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_output</span><span class="p">(</span><span class="s2">&quot;some_other_file.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output_file_name</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – the file name of the output file.
Refer to this file name as a key when using <a class="reference internal" href="#b2luigi.Task.get_input_file_names" title="b2luigi.Task.get_input_file_names"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_input_file_names</span></code></a>,
<code class="xref py py-obj docutils literal notranslate"><span class="pre">get_output_file_names</span></code> or <code class="xref py py-obj docutils literal notranslate"><span class="pre">get_output_file</span></code>.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="b2luigi.Task.get_input_file_names">
<code class="sig-name descname">get_input_file_names</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.Task.get_input_file_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a dictionary of input file names of the tasks, which are defined in our requirements.
Either use the key argument or dictionary indexing with the key given to <a class="reference internal" href="#b2luigi.Task.add_to_output" title="b2luigi.Task.add_to_output"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_to_output</span></code></a>
to get back a list (!) of file paths.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>, optional) – If given, only return a list of file paths with this given key.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>If key is none, returns a dictionary of keys to list of file paths.
Else, returns only the list of file paths for this given key.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="b2luigi.Task.get_output_file_name">
<code class="sig-name descname">get_output_file_name</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.Task.get_output_file_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Analogous to <a class="reference internal" href="#b2luigi.Task.get_input_file_names" title="b2luigi.Task.get_input_file_names"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_input_file_names</span></code></a> this function returns
a an output file defined in out output function with
the given key.</p>
<p>In contrast to <a class="reference internal" href="#b2luigi.Task.get_input_file_names" title="b2luigi.Task.get_input_file_names"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_input_file_names</span></code></a>, only a single file name
will be returned (as there can only be a single output file with a given name).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>key</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – Return the file path with this given key.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Returns only the file path for this given key.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="b2luigi.ExternalTask">
<em class="property">class </em><code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">ExternalTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.ExternalTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">b2luigi.core.task.Task</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">luigi.task.ExternalTask</span></code></p>
<p>Direct copy of <code class="xref py py-obj docutils literal notranslate"><span class="pre">luigi.ExternalTask</span></code>, but with the capabilities of <a class="reference internal" href="#b2luigi.Task" title="b2luigi.Task"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Task</span></code></a> added.</p>
</dd></dl>

<dl class="py class">
<dt id="b2luigi.WrapperTask">
<em class="property">class </em><code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">WrapperTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.WrapperTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">b2luigi.core.task.Task</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">luigi.task.WrapperTask</span></code></p>
<p>Direct copy of <code class="xref py py-obj docutils literal notranslate"><span class="pre">luigi.WrapperTask</span></code>, but with the capabilities of <a class="reference internal" href="#b2luigi.Task" title="b2luigi.Task"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Task</span></code></a> added.</p>
</dd></dl>

<dl class="py function">
<dt id="b2luigi.dispatch">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">dispatch</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">run_function</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.dispatch" title="Permalink to this definition">¶</a></dt>
<dd><p>In cases you have a run function calling external, probably insecure functionalities,
use this function wrapper around your run function.
It basically <cite>emulates</cite> a batch submission on your local computer (without any
batch system) with the benefit of having a totally separete execution path.
If your called task fails miserably (e.g. segfaults), it does not crash your main application.</p>
<p class="rubric">Example</p>
<p>The run function can include any code you want. When the task runs,
it is started in a subprocess and monitored by the parent process.
When it dies unexpectedly (e.g. because of a segfault etc.)
the task will be marked as failed. If not, it is successful.
The log output will be written to two files in the log folder (marked with
the parameters of the task), which you can check afterwards:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">b2luigi</span>

<span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="nd">@b2luigi</span><span class="o">.</span><span class="n">dispatch</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">call_some_evil_function</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are reusing the batch system implementation here, with all its settings
and nobs to setup the environment etc.
If you want to control it in more detail, please check out <a class="reference internal" href="../usage/batch.html#batch-label"><span class="std std-ref">Batch Processing</span></a>.</p>
</div>
<dl class="simple">
<dt>Implementation note:</dt><dd><p>In the subprocess we are calling the current executable (which should by python)
with the current input file as a parameter, but let it only run this
specific task (by handing over the task id and the <cite>–batch-worker</cite> option).
The run function notices this and actually runs the task instead of dispatching again.</p>
</dd>
</dl>
<p>Additionally, you can add a <code class="docutils literal notranslate"><span class="pre">cmd_prefix</span></code> parameter to your class, which also
needs to be a list of strings, which are prefixed to the current command (e.g.
if you want to add a profiler to all your tasks).</p>
</dd></dl>

<dl class="py class">
<dt id="b2luigi.DispatchableTask">
<em class="property">class </em><code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">DispatchableTask</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">*</span><span class="n">args</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.DispatchableTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">b2luigi.core.task.Task</span></code></p>
<p>Instead of using the <a class="reference internal" href="#b2luigi.dispatch" title="b2luigi.dispatch"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dispatch</span></code></a> function wrapper,
you can also inherit from this class.
Except that, it has exactly the same functionality
as a normal <a class="reference internal" href="#b2luigi.Task" title="b2luigi.Task"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Task</span></code></a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You need to overload the process function
instead of the run function in this case!</p>
</div>
<dl class="py method">
<dt id="b2luigi.DispatchableTask.process">
<code class="sig-name descname">process</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.DispatchableTask.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Override this method with your normal run function.
Do not touch the run function itself!</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>As <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> automatically also imports <code class="docutils literal notranslate"><span class="pre">luigi</span></code>, you can use all the parameters from <code class="docutils literal notranslate"><span class="pre">luigi</span></code>
you know and love.
We have just added a single new flag called <code class="docutils literal notranslate"><span class="pre">hashed</span></code> to the parameters constructor.
Turning it to true (it is turned off by default) will make <code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> use a hashed version
of the parameters value, when constructing output or log file paths.
This is especially useful if you have parameters, which may include “dangerous” characters, like “/” or “{” (e.g.
when using list or dictionary parameters).
See also one of our <a class="reference internal" href="../advanced/faq.html#faq-label"><span class="std std-ref">FAQ</span></a>.</p>
</div>
<div class="section" id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="b2luigi.get_setting">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">get_setting</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">default</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">task</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">deprecated_keys</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.get_setting" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">b2luigi</span></code> adds a settings management to <code class="docutils literal notranslate"><span class="pre">luigi</span></code>
and also uses it at various places.
Many batch systems, the output and log path, the environment
etc. is controlled via these settings.</p>
<p>There are four ways settings could be defined.
They are used in the following order (an earlier setting
overrides a later one):</p>
<ol class="arabic">
<li><p>If the currently processed (or scheduled) task has a property
of the given name, it is used.
Please note that you can either set the property directly, e.g.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="n">batch_system</span> <span class="o">=</span> <span class="s2">&quot;htcondor&quot;</span>
</pre></div>
</div>
<p>or by using a function (which might even depend on the parameters)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">batch_system</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;htcondor&quot;</span>
</pre></div>
</div>
<p>The latter is especially useful for batch system specific settings
such as requested wall time etc.</p>
</li>
<li><p>Settings set directly by the user in your script with a call to
<a class="reference internal" href="#b2luigi.set_setting" title="b2luigi.set_setting"><code class="xref py py-meth docutils literal notranslate"><span class="pre">b2luigi.set_setting()</span></code></a>.</p></li>
<li><p>Settings specified in the <code class="docutils literal notranslate"><span class="pre">settings.json</span></code> in the folder of your
script <em>or any folder above that</em>.
This makes it possible to have general project settings (e.g. the output path
or the batch system) and a specific <code class="docutils literal notranslate"><span class="pre">settings.json</span></code> for your sub-project.</p></li>
</ol>
<p>With this function, you can get the current value of a specific setting with the given key.
If there is no setting defined with this name,
either the default is returned or, if you did not supply any default, a value error is raised.</p>
<p>Settings can be of any type, but are mostly strings.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>key</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">str</span></code>) – The name of the parameter to query.</p></li>
<li><p><strong>task</strong> – (<a class="reference internal" href="#b2luigi.Task" title="b2luigi.Task"><code class="xref py py-obj docutils literal notranslate"><span class="pre">b2luigi.Task</span></code></a>): If given, check if the task has a parameter
with this name.</p></li>
<li><p><strong>default</strong> (<em>optional</em>) – If there is no setting which the name,
either return this default or if it is not set,
raise a ValueError.</p></li>
<li><p><strong>deprecated_keys</strong> (<code class="xref py py-obj docutils literal notranslate"><span class="pre">List</span></code>) – Former names of this setting,
will throw a warning when still used</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="b2luigi.set_setting">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">set_setting</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em>, <em class="sig-param"><span class="n">value</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.set_setting" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the setting with the specified name - overriding any <code class="docutils literal notranslate"><span class="pre">setting.json</span></code>.
If you want to have task specific settings, create a
parameter with the given name or your task.</p>
</dd></dl>

<dl class="py function">
<dt id="b2luigi.clear_setting">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">clear_setting</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.clear_setting" title="Permalink to this definition">¶</a></dt>
<dd><p>Clear the setting with the given key</p>
</dd></dl>

</div>
<div class="section" id="other-functions">
<h2>Other functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt id="b2luigi.on_temporary_files">
<code class="sig-prename descclassname">b2luigi.</code><code class="sig-name descname">on_temporary_files</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">run_function</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.on_temporary_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper for decorating a task’s run function to use temporary files as outputs.</p>
<p>A common problem when using long running tasks in luigi is the so called thanksgiving bug
(see <a class="reference external" href="https://www.arashrouhani.com/luigi-budapest-bi-oct-2015/#/21">https://www.arashrouhani.com/luigi-budapest-bi-oct-2015/#/21</a>).
It occurs, when you define an output of a task and in its run function,
you create this output before filling it with content
(maybe even only after a long lasting calculation).
It may happen, that during the creation of the output and the finish of the calculation
some other tasks checks if the output is already there, finds it and assumes,
that the task is already finished (although there is probably only non-sense in the file
so far).</p>
<p>A solution is already given by luigi itself, when using the temporary_path() function
of the file system targets, which is really nice!
Unfortunately, this means you have to open all your output files with a context manager
and this is very hard to do if you have external tasks also (because they will
probably use the output file directly instead of the temporary file version of if).</p>
<p>This wrapper simplifies the usage of the temporary files:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">b2luigi</span>

<span class="k">class</span> <span class="nc">MyTask</span><span class="p">(</span><span class="n">b2luigi</span><span class="o">.</span><span class="n">Task</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">output</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_to_output</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">)</span>

    <span class="nd">@b2luigi</span><span class="o">.</span><span class="n">on_temporary_files</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_output_file_name</span><span class="p">(</span><span class="s2">&quot;test.txt&quot;</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">()</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Test&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead of creating the file “test.txt” at the beginning and filling it with content
later (which will never happen because of the exception thrown, which makes the file
existing but the task actually not finished), the file will be written to a temporary
file first and copied to its final location at the end of the run function (but only if there
was no error).</p>
<p><em>Attention</em>:</p>
<p>The decorator only edits the function get_output_file_name. If you are using
the output directly, you have to take care of using the temporary path correctly by yourself!</p>
</dd></dl>

<dl class="py function">
<dt id="b2luigi.core.utils.product_dict">
<code class="sig-prename descclassname">b2luigi.core.utils.</code><code class="sig-name descname">product_dict</code><span class="sig-paren">(</span><em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#b2luigi.core.utils.product_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-product the given parameters and return a list of dictionaries.</p>
<p class="rubric">Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">product_dict</span><span class="p">(</span><span class="n">arg_1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arg_2</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]))</span>
<span class="go">[{&#39;arg_1&#39;: 1, &#39;arg_2&#39;: 3}, {&#39;arg_1&#39;: 1, &#39;arg_2&#39;: 4}, {&#39;arg_1&#39;: 2, &#39;arg_2&#39;: 3}, {&#39;arg_1&#39;: 2, &#39;arg_2&#39;: 4}]</span>
</pre></div>
</div>
<p>The thus produced list can directly be used as inputs for a required tasks:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">requires</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">product_dict</span><span class="p">(</span><span class="n">arg_1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">arg_2</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]):</span>
        <span class="k">yield</span> <span class="n">some_task</span><span class="p">(</span><span class="o">**</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>kwargs</strong> – Each keyword argument should be an iterable</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of kwargs where each list of input keyword arguments is cross-multiplied with every other.</p>
</dd>
</dl>
</dd></dl>

<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="b2luigi.basf2_helper.html">b2luigi.basf2_helper package</a></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="b2luigi.basf2_helper.html" class="btn btn-neutral float-right" title="b2luigi.basf2_helper package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../advanced/basf2-examples.html" class="btn btn-neutral float-left" title="Belle II specific examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Nils Braun

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>